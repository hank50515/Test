<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/template.xhtml">
	<ui:define name="title">#{msg['page.header.viewSourceCode']}</ui:define>
	<ui:define name="head">

		<link type="text/css" rel="stylesheet" href="${contextPath}/js/syntaxhighlighter/styles/shCoreDefault.css" />
  		<link rel="stylesheet" type="text/css" href="${contextPath}/css/adm/selected_entities_modal.css?${currentVersion}" />
		<link rel="stylesheet" type="text/css" href="${contextPath}/css/adm/analysis_cart.css?${currentVersion}" />
		<link type="text/css" rel="stylesheet" href="${contextPath}/css/adm/view_source_code.css?${currentVersion}" />
		<link type="text/css" rel="stylesheet" href="${contextPath}/css/adm/syntaxhighlighter_override.css" />

		<script type="text/javascript" src="${contextPath}/js/jquery.highlight/jquery.highlight.js"></script>
		<script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shCore.js"></script>

		<!-- brushes -->
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushJScript.js"></script>
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushJava.js"></script>
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushCSharp.js"></script>
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushVb.js"></script>
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushSql.js"></script>
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushJScript.js"></script>
        <script type="text/javascript" src="${contextPath}/js/syntaxhighlighter/scripts/shBrushXml.js"></script>

		<script type="text/javascript" src="${contextPath}/js/adm/service/impactAnalysisService.js?${currentVersion}"></script>
		<script src="${contextPath}/js/adm/service/entityService.js"></script>
		<script type="text/javascript" src="${contextPath}/js/adm/controller/selectedEntitiesModalController.js?${currentVersion}"></script>
  
		<script type="text/javascript" src="${contextPath}/js/adm/controller/view-source-code-modal.js?${currentVersion}"></script>
		<script type="text/javascript" src="${contextPath}/js/adm/controller/view-source-code.js?${currentVersion}"></script>

		<script id="sourceCodeForwardLink-template" type="text/kendo-ui-template">
        # for( var i=0 ; (i &lt; entities.length) ; i++) { #
          <a class='entityLink forward pointer' entityId='#:entities[i].sourceEntityId#'  targetline='#:entities[i].targetEntityLineNumber#'> line (#: entities[i].targetEntityLineNumber#) : #: entities[i].targetEntityName# - #: entities[i].methodName#</a>
        # } #
        </script>

		<script id="sourceCodeBackwardLink-template" type="text/kendo-ui-template">
      # for( var i=0 ; (i &lt; entities.length) ; i++) { #
          <a class='entityLink backward pointer' entityId='#:entities[i].sourceEntityId#'  targetline='#:entities[i].sourceEntityLineNumber#'> line (#: entities[i].sourceEntityLineNumber#) : #: entities[i].sourceEntityName# - #: entities[i].sourceMethodName#</a>
      # } #
  </script>

		<script id="methodForwardLink-template" type="text/kendo-ui-template">
      # for( var i=0 ; (i &lt; entities.length) ; i++) { #
          <a class='entityLink forward pointer' entityId='#:entities[i].targetEntityId#' line='#:entities[i].sourceEntityLineNumber#' targetline='#:entities[i].targetEntityLineNumber#'> line (#: entities[i].sourceEntityLineNumber#) : #: entities[i].methodName#</a>
      # } #
  </script>

		<script id="methodBackwardLink-template" type="text/kendo-ui-template">
      # for( var i=0 ; (i &lt; entities.length) ; i++) { #
          <a class='entityLink backward pointer' entityId='#:entities[i].sourceEntityId#' line='#:entities[i].targetEntityLineNumber#' targetline='#:entities[i].sourceEntityLineNumber#'> backward line(#: entities[i].sourceEntityLineNumber#), current line (#: entities[i].targetEntityLineNumber#) : #: entities[i].methodName#</a>
      # } #
  </script>

		<script id="treeview-template" type="text/kendo-ui-template">
      #: item.name # 
      # if ( item.forward ) { #
          <div class="tree-triangle-right triangle-right inlineBlock">▶</div>
      # } else if ( item.backward ) { #
          <div class="tree-triangle-left triangle-left inlineBlock">◀</div>
      # } #
  </script>

	<script id="addRelation-template" type="text/ng-template">
		<div class="modal-header" style="display: flex;justify-content:space-between;">
			<div class="inlineBlock">
				<h4 class="modal-title">自建程式碼與 CI 間關聯</h4>
			</div>
			<div class="inlineBlock">
				<button class="k-button k-button-icon" ng-click="cancel()">
        	      	<span class="k-icon k-i-close" />
				</button>
			</div>
		</div>
		<div class="modal-body">
			<div class="table-layout">
				<div>
					<div class="top-padding column-3">選取文字內容</div>
					<div class="top-padding left-padding column-10">
						<textarea readonly="readonly" class="k-textbox column-10" style="height:100px;" ng-model="selectedInfo.selectedText"></textarea>
					</div>
				</div>
				<div>
					<div class="top-padding"/>
					<div class="top-padding left-padding"/>
				</div>
				<div ng-show="isShowPrevious()">
					<div class="top-padding">上一次的選取文字</div>
					<div class="top-padding left-padding">
						<textarea readonly="readonly" class="k-textbox column-10" style="height:100px;" ng-model="previousSelectedText"></textarea>
					</div>
				</div>
				<div>
					<div class="top-padding">Step1. 選擇關聯 CI</div>
					<div class="top-padding left-padding">
						<select kendo-drop-down-list="definitions"
								k-options="definitionOptions"
								ng-model="definitionId" 
								ng-disabled="disableDefinitions">
						</select>
						<input class="column-7" 
							kendo-auto-complete="targetEntities" 
							k-options="targetEntityOptions"
							ng-keyup="tryTriggerSearch()"
							ng-model="targetEntityName"
							ng-disabled="disableTargetEntity" />
					</div>
				</div>
				<div>
					<div class="top-padding">Step2. 輸入與 CI 有關的文字</div>
					<div class="top-padding left-padding">
						<textarea class="k-textbox column-10" style="height:100px;" ng-model="selectedInfo.targetText"></textarea>
					</div>
				</div>
				<div>
					<div class="top-padding">Step3. 選擇關聯類型</div>
					<div class="top-padding left-padding">
						<select kendo-drop-down-list="relationTypes" 
								k-options="relationTypeOptions"
								ng-model="relationTypeId"
								ng-disabled="disableRelationTypes">
						</select>
					</div>
				</div>
				<div>
					<div ng-show="showTemplate" class="top-padding">Step4. 選擇 Template<br />或輸入 Template 名稱</div>
					<div ng-show="!showTemplate" class="top-padding">Step4. 輸入 Template 名稱</div>
					<div class="top-padding left-padding">
						<div ng-show="showTemplate">
							<select class="column-6"
									kendo-drop-down-list="templates"
									k-options="templateOptions" 
									ng-model="templateId" />
						</div>
						<div class="top-padding" ng-show="!templateId">
							<input class="k-textbox column-6" 
								ng-model="templateName"
								ng-disabled="disableTemplateName" />
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="modal-footer">
            <button class="btn btn-success pull-left" ng-click="manageRelation()">#{msg["button.manageRelation"]}</button>
			<button class="btn btn-primary" ng-click="saveCase()">#{msg["button.common.save"]}</button>
			<button class="btn btn-warning" ng-click="cancel()">#{msg["button.common.cancel"]}</button>
		</div>
	</script>

	</ui:define>
	<ui:define name="body">
		<div ng-controller="sourceCodeControl" class="height-100p">
			<div id="splitter" kendo-splitter="" k-orientation="'horizontal'" k-panes="[{ collapsible: true, size: '25%' }, {} ]"
				ng-cloak="" class="height-100p">
				<!-- method tree list -->
				<div class="sourceCodeMethodTreeMainContent">
					<div class="top-padding left-padding" ng-disable="showInsertButton">
						<button class="k-button k-button-icon" data-ng-click="addIntoCart()"
							title="{{INSERT_INTO_IMPACT_ANALYSIS}}">
		                    <span class="k-icon k-i-plus" />
		                    <span>#{msg["button.addImpactList"]}</span>
		                </button>
					</div>
					<div id="sourceCodeMethodTree" />
				</div>

				<!-- source code content -->
				<div class="sourceCodeContentMainContent">
					<div id="sourceCodeContent" ng-show="showCodeFlag">
						<span class="highlightData">
							<pre ng-model="sourceCodeContent" ng-cloak="" class="brush: {{syntaxHighlightExtensionName}}">{{sourceCodeContent}}</pre>
						</span>
					</div>
					<div class="all-padding addRelationButton" title='#{msg["button.buildRelation"]}' style="display: none;">
						<button class="k-button k-button-icon">
		        	      	<span class="k-icon k-i-pencil" />
						</button>
					</div>
				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>
</html>